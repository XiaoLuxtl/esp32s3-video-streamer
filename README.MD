# ğŸ“¸ ESP32-S3 Camera WebSocket (Modular)

<p align="center">
  <video 
    src="https://github.com/user-attachments/assets/8f298395-81b6-4b6e-a4ea-9b2534fb09f9" 
    width="800" 
    autoplay 
    muted 
    loop 
    playsinline 
    title="Demo del sistema de streaming y panel de control">
    Tu navegador no soporta videos incrustados. Puedes ver la demo directamente en el enlace de assets.
  </video>
</p>

Sistema de streaming de video de alta eficiencia diseÃ±ado para el **ESP32-S3-DevKitC-1** con sensor **OV3660**. Este proyecto destaca por una arquitectura de comunicaciÃ³n desacoplada y un firmware altamente modularizado.
---

## ğŸ—ï¸ Arquitectura de ComunicaciÃ³n Dual

Para optimizar el rendimiento y evitar latencia en los comandos por el flujo de datos, el sistema utiliza dos canales WebSockets independientes:

* **Puerto 6971 (Control & UI):** Canal para el envÃ­o de comandos JSON desde la interfaz web y recepciÃ³n de telemetrÃ­a/estadÃ­sticas.
* **Puerto 6972 (Binary Stream):** Canal de alta prioridad dedicado exclusivamente a la transferencia de frames binarios desde el ESP32 hacia el servidor.



---

## ğŸ“‚ Estructura del Proyecto

```text
.
â”œâ”€â”€ firmware                 # Desarrollo C++ (PlatformIO)
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”œâ”€â”€ camera_manager   # Control avanzado del sensor OV3660
â”‚   â”‚   â”œâ”€â”€ command_processor# Procesador de comandos y lÃ³gica de control
â”‚   â”‚   â”œâ”€â”€ configuration    # DefiniciÃ³n de pines y credenciales (secrets)
â”‚   â”‚   â”œâ”€â”€ fps_controller   # Regulador de tasa de frames
â”‚   â”‚   â”œâ”€â”€ frame_sender     # Empaquetado binario y envÃ­o de imÃ¡genes
â”‚   â”‚   â”œâ”€â”€ health_monitor   # Monitor de recursos y rendimiento
â”‚   â”‚   â”œâ”€â”€ websocket_manager# GestiÃ³n de conexiones duales (6971/6972)
â”‚   â”‚   â””â”€â”€ wifi_manager     # LÃ³gica de red y reconexiÃ³n automÃ¡tica
â”‚   â””â”€â”€ platformio.ini       # ConfiguraciÃ³n de entorno y dependencias
â””â”€â”€ server                   # Fullstack Server (Python/JS)
    â”œâ”€â”€ app.py               # Punto de entrada Flask/WebSockets
    â”œâ”€â”€ camera_server.py     # LÃ³gica de backend para el procesamiento de stream
    â”œâ”€â”€ static/js            # MÃ³dulos frontend (WebSockets, Controls, UI)
    â””â”€â”€ templates            # Interfaz de usuario reactiva (Jinja2)
```

---

## ğŸ•¹ï¸ Control de CÃ¡mara (API de Comandos)

Los comandos se envÃ­an vÃ­a JSON a travÃ©s del puerto **6971**:

| Comando | Rango / Valor | DescripciÃ³n |
| :--- | :--- | :--- |
| `resolution` | 0 - 12 | Desde QQVGA hasta QXGA (3MP) |
| `quality` | 0 - 63 | Factor de compresiÃ³n JPEG (Menor = Mayor calidad) |
| `brightness` | -2 a 2 | CompensaciÃ³n de exposiciÃ³n |
| `vflip` / `hmirror` | 0 / 1 | InversiÃ³n y rotaciÃ³n de imagen |
| `reboot` | - | Reinicio remoto del hardware |

---

## ğŸš€ InstalaciÃ³n y Despliegue

### 1. Firmware (ESP32-S3)
1. DirÃ­gete a `firmware/src/configuration/`.
2. Renombra `secrets.h.example` a `secrets.h` y completa tus credenciales WiFi e IP del servidor.
3. Carga el cÃ³digo usando **PlatformIO**:
```bash
pio run --target upload
```

### 2. Servidor (Python)
1. Instala las dependencias:
```bash
cd server
pip install -r requirements.txt
```
2. Ejecuta la aplicaciÃ³n:
```bash
python app.py
```

---

## ğŸ› ï¸ TecnologÃ­as Utilizadas
* **Firmware:** C++, PlatformIO, Arduino Core, ESPAsyncWebServer.
* **Backend:** Python 3.x, Flask, Eventlet, WebSockets.
* **Frontend:** HTML5, CSS3 (Modern UI), Vanilla JavaScript (Modular).

---

## ğŸ“„ Licencia
Este proyecto estÃ¡ bajo la Licencia **MIT**.
