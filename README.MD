# ğŸ“¸ ESP32-S3 Camera WebSocket (Modular)

<p align="center">
  <video 
    src="https://github.com/user-attachments/assets/8f298395-81b6-4b6e-a4ea-9b2534fb09f9" 
    width="800" 
    autoplay 
    muted 
    loop 
    playsinline 
    title="Demo del sistema de streaming y panel de control">
    Tu navegador no soporta videos incrustados. Puedes ver la demo directamente en el enlace de assets.
  </video>
</p>

Sistema de streaming de video de alta eficiencia diseÃ±ado para el **ESP32-S3-N16R8** con sensor **OV3660**. Este proyecto destaca por una arquitectura de comunicaciÃ³n desacoplada y un firmware altamente modularizado.
---

## ğŸ—ï¸ Arquitectura de ComunicaciÃ³n Dual

Para optimizar el rendimiento y evitar latencia en los comandos por el flujo de datos, el sistema utiliza dos canales WebSockets independientes:

* **Puerto 6971 (Control & UI):** Canal para el envÃ­o de comandos JSON desde la interfaz web y recepciÃ³n de telemetrÃ­a/estadÃ­sticas.
* **Puerto 6972 (Binary Stream):** Canal de alta prioridad dedicado exclusivamente a la transferencia de frames binarios desde el ESP32 hacia el servidor.



---

## ğŸ“‚ Estructura del Proyecto

```text
.
â”œâ”€â”€ firmware                 # Desarrollo C++ (PlatformIO)
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”œâ”€â”€ camera_manager   # LÃ³gica de bajo nivel para el sensor OV3660
â”‚   â”‚   â”œâ”€â”€ command_processor# Parser de JSON y ejecuciÃ³n de acciones
â”‚   â”‚   â”œâ”€â”€ configuration    # ConfiguraciÃ³n de red, pines y secretos
â”‚   â”‚   â”œâ”€â”€ fps_controller   # GestiÃ³n de tiempos y suavidad del stream
â”‚   â”‚   â”œâ”€â”€ frame_sender     # Empaquetado binario de frames para transporte
â”‚   â”‚   â”œâ”€â”€ health_monitor   # TelemetrÃ­a de sistema (Memoria, Uptime)
â”‚   â”‚   â”œâ”€â”€ websocket_manager# Cliente WebSocket dual (Control/Stream)
â”‚   â”‚   â”œâ”€â”€ wifi_manager     # GestiÃ³n de conexiÃ³n y watchdog de red
â”‚   â”‚   â””â”€â”€ main.cpp         # Orquestador principal del sistema
â”‚   â””â”€â”€ platformio.ini       # Dependencias y perfiles de compilaciÃ³n
â”‚
â””â”€â”€ server                   # Backend & Frontend (Python/JS)
    â”œâ”€â”€ app.py               # Servidor Flask y punto de entrada
    â”œâ”€â”€ camera_server.py     # Procesamiento lÃ³gico del stream entrante
    â”œâ”€â”€ image_saver.py       # Utilidad para persistencia de capturas
    â”œâ”€â”€ requirements.txt     # Dependencias de Python
    â”œâ”€â”€ static/
    â”‚   â”œâ”€â”€ css/             # Estilos modernos del Dashboard
    â”‚   â””â”€â”€ js/              # Arquitectura Frontend Modular:
    â”‚       â”œâ”€â”€ websocket.js # GestiÃ³n de tÃºneles de datos
    â”‚       â”œâ”€â”€ controls.js  # LÃ³gica de la interfaz de usuario
    â”‚       â”œâ”€â”€ image-saver.js # InteracciÃ³n con el sistema de guardado
    â”‚       â”œâ”€â”€ notifications.js # Feedback visual al usuario
    â”‚       â””â”€â”€ app.js       # InicializaciÃ³n y pegamento del frontend
    â””â”€â”€ templates/           # Estructura de plantillas Jinja2:
        â”œâ”€â”€ components/      # Fragmentos reutilizables (Sidebar, Feed, Header)
        â””â”€â”€ index.html       # Vista principal
```

---

## ğŸ•¹ï¸ Control de CÃ¡mara (API de Comandos)

Los comandos se envÃ­an vÃ­a JSON a travÃ©s del puerto **6971**:

| Comando | Rango / Valor | DescripciÃ³n |
| :--- | :--- | :--- |
| `resolution` | 0 - 12 | Desde QQVGA hasta QXGA (3MP) |
| `quality` | 0 - 63 | Factor de compresiÃ³n JPEG (Menor = Mayor calidad) |
| `brightness` | -2 a 2 | CompensaciÃ³n de exposiciÃ³n |
| `vflip` / `hmirror` | 0 / 1 | InversiÃ³n y rotaciÃ³n de imagen |
| `reboot` | - | Reinicio remoto del hardware |

---

## ğŸš€ InstalaciÃ³n y Despliegue

### 1. Firmware (ESP32-S3)
1. DirÃ­gete a `firmware/src/configuration/`.
2. Renombra `secrets.h.example` a `secrets.h` y completa tus credenciales WiFi e IP del servidor.
3. Carga el cÃ³digo usando **PlatformIO**:
```bash
pio run --target upload
```

### 2. Servidor (Python)
1. Instala las dependencias:
```bash
cd server
pip install -r requirements.txt
```
2. Ejecuta la aplicaciÃ³n:
```bash
python app.py
```

---

## ğŸ› ï¸ TecnologÃ­as Utilizadas
* **Firmware:** C++, PlatformIO, Arduino Core, ESPAsyncWebServer.
* **Backend:** Python 3.x, Flask, Eventlet, WebSockets.
* **Frontend:** HTML5, CSS3 (Modern UI), Vanilla JavaScript (Modular).

---

## ğŸ“„ Licencia
Este proyecto estÃ¡ bajo la Licencia **MIT**.
